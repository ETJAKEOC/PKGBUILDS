pkgname=make
pkgver=4.4.1
pkgrel=2
pkgdesc="GNU make utility to maintain groups of programs"
arch=('x86_64')
url="https://www.gnu.org/software/make"
license=('GPL3')
depends=('glibc' 'guile')
source=("https://ftp.gnu.org/gnu/${pkgname}/${pkgname}-${pkgver}.tar.lz")
sha256sums=('SKIP')

build() {
  cd "$pkgname-$pkgver"

  CC=clang CPP=clang-cpp CXX=clang++ LDFLAGS="-fuse-ld=lld -flto -O3 -pthread" \
  CFLAGS="-march=znver2 -mtune=znver2 -pipe -O3 -flto -g0" \
  CPPFLAGS="-march=znver2 -mtune=znver2 -pipe -O3 -flto -g0" \
  CXXFLAGS="-march=znver2 -mtune=znver2 -pipe -O3 -flto -g0" \
  GUILE_CFLAGS="-march=znver2 -mtune=znver2 -pipe -O3 -flto -g0" \
  ./configure --prefix=/usr --enable-year2038 --without-guile --disable-nls --disable-rpath --without-gnu-ld

  LLVM=1 LLVM_IAS=1 make -j$(nproc)
}

package() {
	cd "$pkgname-$pkgver"
	make prefix="${pkgdir}"/usr install
}
