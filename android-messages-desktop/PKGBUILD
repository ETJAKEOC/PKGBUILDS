# Maintainer: ETJAKEOC <ETJAKEOC@gmail.com>
pkgname=android-messages-desktop
pkgver=1.0.0
pkgrel=1
pkgdesc="Native-like Android Messages wrapper using Electron"
arch=('x86_64')
url="https://messages.google.com/web/"
license=('GPL')
depends=('electron')
makedepends=('nodejs' 'npm')
source=('app.tar.gz' 'android-messages-desktop' 'android-messages-desktop.desktop' 'android-messages-desktop.png')
sha256sums=('SKIP' 'SKIP' 'SKIP' 'SKIP')
options=('strip' 'lto' '!emptydirs')

build() {
    cd "$srcdir"
    tar xzf app.tar.gz

    cd app
    npm install --production

    # Pack app into asar
    npx asar pack . "$srcdir/app.asar"
}

package() {
    # Install application
    install -Dm644 "$srcdir/app.asar" "$pkgdir/opt/android-messages-desktop/app.asar"
    install -Dm755 "$srcdir/android-messages-desktop" "$pkgdir/usr/bin/android-messages-desktop"
    install -Dm644 "$srcdir/android-messages-desktop.desktop" "$pkgdir/usr/share/applications/android-messages-desktop.desktop"
    install -Dm644 "$srcdir/android-messages-desktop.png" "$pkgdir/usr/share/pixmaps/android-messages-desktop.png"

    # Make wrapper executable
    chmod +x "$pkgdir/usr/bin/android-messages-desktop"
}
