# Maintainer: ETJAKEOC <ETJAKEOC@gmail.com>
pkgname=everycircuit-desktop
pkgver=1.0.0
pkgrel=1
pkgdesc="Native-like EveryCircuit wrapper using Electron"
arch=('x86_64')
url="https://everycircuit.com/"
license=('GPL')
depends=('electron')
makedepends=('nodejs' 'npm')
source=('app.tar.gz' 'everycircuit' 'everycircuit.desktop' 'everycircuit.png')
sha256sums=('SKIP' 'SKIP' 'SKIP' 'SKIP')
options=('strip' 'lto' '!emptydirs')

build() {
    cd "$srcdir"
    tar xzf app.tar.gz

    cd app
    npm install --production

    # Pack app into asar
    npx asar pack . "$srcdir/app.asar"
}

package() {
    # Install application
    install -Dm644 "$srcdir/app.asar" "$pkgdir/opt/$pkgname/everycircuit/app.asar"
    install -Dm755 "$srcdir/everycircuit" "$pkgdir/usr/bin/everycircuit"
    install -Dm644 "$srcdir/everycircuit.desktop" "$pkgdir/opt/$pkgname/applications/everycircuit.desktop"
    install -Dm644 "$srcdir/everycircuit.png" "$pkgdir/opt/$pkgname/pixmaps/everycircuit.png"

    # Make wrapper executable
    chmod +x "$pkgdir/usr/bin/everycircuit"
}
