# Maintainer: ETJAKEOC <ETJAKEOC@gmail.com>
pkgname=chatgpt-electron
pkgver=1.0.1
pkgrel=1
pkgdesc="Native-like ChatGPT wrapper using Electron"
arch=('x86_64')
url="https://chat.openai.com/"
license=('GPL')
depends=('electron')
makedepends=('nodejs' 'npm')
source=("main.js" "package.json" "chatgpt-electron.desktop" "chatgpt-electron.png")
sha256sums=('SKIP' 'SKIP' 'SKIP' 'SKIP')
options=('!emptydirs')

prepare() {
    cd "$srcdir"
    rm chatgpt-electron.desktop main.js chatgpt-electron.png package.json
    cp ../chatgpt-electron.desktop .
    cp ../main.js .
    cp ../chatgpt-electron.png .
    cp ../package.json .
}

build() {
    cd "$srcdir"
    npm install --omit=dev
    npx asar pack . "$srcdir/app.asar"
}

package() {
install -Dm644 "$srcdir/app.asar" "$pkgdir/opt/$pkgname/app.asar"
    install -d "$pkgdir/usr/bin"
    cat > "$pkgdir/usr/bin/chatgpt-electron" <<'EOF'
#!/bin/bash
exec /usr/bin/electron /opt/chatgpt-electron/app.asar "$@"
EOF
    chmod +x "$pkgdir/usr/bin/chatgpt-electron"
    install -Dm644 "$srcdir/chatgpt-electron.desktop" "$pkgdir/usr/share/applications/chatgpt-electron.desktop"
    install -Dm644 "$srcdir/chatgpt-electron.png" "$pkgdir/usr/share/pixmaps/chatgpt-electron.png"
}
